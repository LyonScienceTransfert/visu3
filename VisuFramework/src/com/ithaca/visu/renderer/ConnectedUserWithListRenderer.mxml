<?xml version="1.0" encoding="utf-8"?>
<s:ItemRenderer xmlns:fx="http://ns.adobe.com/mxml/2009" 
				xmlns:s="library://ns.adobe.com/flex/spark" 
				xmlns:mx="library://ns.adobe.com/flex/mx" 
				autoDrawBackground="false" xmlns:controls="com.ithaca.visu.controls.*">
	<fx:Script>
		<![CDATA[
			import com.ithaca.visu.events.SessionHomeElementEvent;
			import com.lyon2.visu.model.User;
			import com.ithaca.visu.ui.utils.RoleEnum;
			
			import mx.events.FlexEvent;
			
			import spark.events.IndexChangeEvent;

			protected function list_changeHandler(event:IndexChangeEvent):void
			{
				var newUser:User = data.swapList.getItemAt( event.newIndex );
				statusIcon.status = newUser.status;
				updateStyle( newUser );
				var oldUser:User = data.swapList.getItemAt( event.oldIndex );
				
				var sessionHomeElementEvent:SessionHomeElementEvent = new SessionHomeElementEvent(SessionHomeElementEvent.CHANGE_SESSION_USER);
				sessionHomeElementEvent.oldSessionUser = oldUser;
				sessionHomeElementEvent.newSessionUser = newUser;
				parent.dispatchEvent(sessionHomeElementEvent);
			}


			protected function list_creationCompleteHandler(event:FlexEvent):void
			{
				for each(var u:User in data.swapList)
				{
					if( data.user.mail == u.mail) 
					{
						list.selectedItem = u;						
						updateStyle( u );
						statusIcon.status = u.status;
						return;
					}
				}
			}
			protected function updateStyle(user:User):void
			{
				if( user.role > RoleEnum.STUDENT )
					
					list.setStyle("fontWeight","bold")
				else
					list.setStyle("fontWeight","normal")
			}
		]]>
	</fx:Script>
	 
	<s:DropDownList 
		id="list"
		dataProvider="{data.swapList}"
		itemRenderer="com.ithaca.visu.renderer.ConnectedUserListRenderer"
		skinClass="com.ithaca.visu.skins.ConnectedUserDropDownSkin"
		cornerRadius="10"
		labelField="firstname"
		creationComplete="list_creationCompleteHandler(event)"
		change="list_changeHandler(event)"
		/>
	<!--status="{data.user.status}"-->
	<controls:ConnectionLight
		id="statusIcon" 
		left="5" width="10" height="10" verticalCenter="-1"
		/>
</s:ItemRenderer>
