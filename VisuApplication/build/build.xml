<?xml version="1.0" encoding="UTF-8"?>
<!--ant-->

<!-- As this builds all visu2 projects, the basedir points to the root of all visu2 directories -->

<project name="Visu Client Builder" default="build_all">
   <!-- Dev path--> 
   <property name="visu.dev.path" location="/home/dcram/dev/ws-visu2/visu" />
   <property name="player.major.version" value="10.1" />
   <property name="locale" value="en_US" />
   <property name="debug" value="true" />
   <property name="app.name" value="visuclient" />

   <property name="flex.sdk" location="/home/dcram/Applications/flexsdk4"/>
   <property name="FLEX_HOME" location="${flex.sdk}"/>
   
	<!-- add flex ant task -->
   <taskdef resource="flexTasks.tasks" classpath="${flex.sdk}/ant/lib/flexTasks.jar"/>

   <property name="build.dir" location="${visu.dev.path}/VisuApplication/build"/>
	
   <!-- Application related path--> 
   <property name="app.src" location="${visu.dev.path}/VisuApplication/src" />
   <property name="app.deploy" location="${visu.dev.path}/deploy" />
	
	<!-- Visu framework related path--> 
   <property name="framework.path" location="${visu.dev.path}/VisuFramework" />
   <property name="framework.src" location="${framework.path}/src" />
   <property name="framework.images" location="${framework.src}/images" />
   <property name="framework.bin" location="${framework.path}/bin" />
   <property name="framework.linkreport" location="${framework.bin}/link-report.xml" />
   <property name="framework.locale" location="${framework.path}/locale" />
	<!-- The temporary asset SWC that contains embedded ressources -->
   <property name="framework.assets.swc" value="visu_framework.assets.swc" />
   <property name="framework.swc" value="visu_framework.swc" />
	
	<!--  Pathes to third party libraries-->	
   <property name="thirdparty.dir" location="${visu.dev.path}/swc" />
   <property name="lib.swfaddress" value="SWFAddress.swc" />
   <property name="lib.mate" value="Mate_08_9.swc" />
   <property name="lib.rmtp" value="rtmp-service-1.0.swc" />
   <property name="lib.as3gettext" value="as3-gettext-0.4.1.swc" />

	<!--  Pathes to User Module sources -->	
   <property name="usermodule.src" location="${visu.dev.path}/UserModule/src" />
   <property name="usermodule.name" value="UserModule" />

	<!--  Pathes to Session Module sources -->	
   <property name="sessionmodule.src" location="${visu.dev.path}/SessionModule/src" />
   <property name="sessionmodule.name" value="SessionModule" />

	<!--  Pathes to Tutorat Module sources -->	
   <property name="tutoratmodule.src" location="${visu.dev.path}/TutoratModule/src" />
   <property name="tutoratmodule.name" value="TutoratModule" />

	<!--  Pathes to Home Module sources -->	
   <property name="homemodule.src" location="${visu.dev.path}/HomeModule/src" />
   <property name="homemodule.name" value="HomeModule" />

	<!--  Pathes to Retrospection Module sources -->	
   <property name="retrospectionmodule.src" location="${visu.dev.path}/RetrospectionModule/src" />
   <property name="retrospectionmodule.name" value="RetrospectionModule" />

	
   

    

   <!-- Build Application -->
   <target name="build_application"> 
      <echo>Build main application (shell)</echo>
      <mxmlc 
         file="${app.src}/${app.name}.mxml"
         output="${app.deploy}/${app.name}.swf"
         debug="${debug}"
         strict="true" 
         link-report="${framework.linkreport}" 
         optimize="true" 
         warnings="true"
		 incremental="true"
         headless-server="true">
         
         <!-- define a source path (will include all files with .css, .as, .mxml extensions) -->
         <source-path path-element="${app.src}"/>
      	
         <library-path dir="${framework.bin}" append="true">
            <include name="${framework.swc}" />
         </library-path>
      	
      	 <library-path dir="${thirdparty.dir}" append="true">
      		            <include name="${lib.swfaddress}" />
      		            <include name="${lib.mate}" />
      		            <include name="${lib.rmtp}" />
      		            <include name="${lib.as3gettext}" />
      		         </library-path>
      	
      </mxmlc>
   </target>

	<target name="build_framework_libs">
	      <echo>Compile framework library</echo>
	       
	  	  <compc 
	         output="${framework.bin}/${framework.assets.swc}"
	         debug="${debug}" 
	         strict="true" 
		      	incremental="true"
	         optimize="true" 
	   	    warnings="true"
	         headless-server="true">
	  		  	<include-file name="images/ArrowDown.png" path="${framework.images}/ArrowDown.png"/>
	  			<include-file name="images/ArrowUp.png" path="${framework.images}/ArrowUp.png"/>
	  		  	<include-file name="images/chatMessageVisu1.png" path="${framework.images}/chatMessageVisu1.png"/>
	  		  	<include-file name="images/CommentAddVer1.png" path="${framework.images}/CommentAddVer1.png"/>
	  		  	<include-file name="images/CommentVer4.png" path="${framework.images}/CommentVer4.png"/>
	  		  	<include-file name="images/consigneVisu1.png" path="${framework.images}/consigneVisu1.png"/>
	  		  	<include-file name="images/Editer.png" path="${framework.images}/Editer.png"/>
	  	  	    <include-file name="images/fichierVisu1.png" path="${framework.images}/fichierVisu1.png"/>
	  	  	    <include-file name="images/iconPlus.png" path="${framework.images}/iconPlus.png"/>
	  	  	    <include-file name="images/iconMinus.png" path="${framework.images}/iconMinus.png"/>
	  		  	<include-file name="images/marqueurBlanc-bas-20px.png" path="${framework.images}/marqueurBlanc-bas-20px.png"/>
	  		  	<include-file name="images/messageChat.png" path="${framework.images}/messageChat.png"/>
	  		  	<include-file name="images/motCleVisu1.png" path="${framework.images}/motCleVisu1.png"/>

	  		  	<include-file name="images/PauseVer4.png" path="${framework.images}/PauseVer4.png"/>
	  		  	<include-file name="images/PlayVer4.png" path="${framework.images}/PlayVer4.png"/>
	  		  	<include-file name="images/PlayWalkOutVer5.png" path="${framework.images}/PlayWalkOutVer5.png"/>
	  		  	<include-file name="images/PressSliderVer5.png" path="${framework.images}/PressSliderVer5.png"/>
	  		  	<include-file name="images/Poubelle.png" path="${framework.images}/Poubelle.png"/>
	  		  	<include-file name="images/ReleaseSliderVer5.png" path="${framework.images}/ReleaseSliderVer5.png"/>
		  	  	<include-file name="images/SharedOtherToThisRedVer1.png" path="${framework.images}/SharedOtherToThisRedVer1.png"/>
	  		  	<include-file name="images/SharedOtherToThisVer1.png" path="${framework.images}/SharedOtherToThisVer1.png"/>
	  		  	<include-file name="images/SharedThisToOtherRedVer1.png" path="${framework.images}/SharedThisToOtherRedVer1.png"/>
	  		  	<include-file name="images/SharedThisToOtherVer1.png" path="${framework.images}/SharedThisToOtherVer1.png"/>
	  		  	<include-file name="images/StopVer4.png" path="${framework.images}/StopVer4.png"/>
	  		  	<include-file name="images/video.jpg" path="${framework.images}/video.jpg"/>

	  	  		<include-file name="locale/en_US/HumanDate.properties" path="${framework.locale}/en_US/HumanDate.properties"/>
	  	  		<include-file name="locale/fr_FR/HumanDate.properties" path="${framework.locale}/fr_FR/HumanDate.properties"/>
	  	  	
	  	  		<include-file name="defaults.css" path="${framework.src}/defaults.css"/>
	  	  	
	  	  	</compc>
		
	  	  <compc 
	         output="${framework.bin}/${framework.swc}"
	         debug="${debug}" 
	         strict="true" 
	         optimize="true" 
		      	incremental="true"
	   	    warnings="true"
	         headless-server="true">

	      	<!-- add external swc-->
	      	<external-library-path dir="${flex.sdk}/frameworks" append="true">
	      		<include name="libs/player/${player.major.version}/playerglobal.swc" />
	      		<include name="libs/textLayout.swc" />
	      		<include name="libs/osmf.swc" />
	      		<include name="libs/framework.swc" />
	      		<include name="libs/spark.swc" />
	      		<include name="libs/sparkskins.swc" />
	      		<include name="libs/rpc.swc" />
	      	</external-library-path>
	      	
	   	  	<!-- add library swc-->
	      	<library-path dir="${flex.sdk}/frameworks" append="true">
	      		<include name="flash-integration.swc" />
	      	</library-path>
	  	  	
	  	      	<include-libraries dir="${framework.bin}" append="true">
	  	      		            <include name="${framework.assets.swc}" />
	  	      		         </include-libraries>
	      	
	  	  <!-- define a library path -->
	         <library-path dir="${thirdparty.dir}" append="true">
	            <include name="${lib.swfaddress}" />
	            <include name="${lib.mate}" />
	            <include name="${lib.rmtp}" />
	            <include name="${lib.as3gettext}" />
	         </library-path>
	         
	         <!-- define the source path -->
	         <include-sources dir="${framework.src}" includes="*"/>
	         <source-path path-element="${framework.src}" />

	  	  	<include-file name="defaults.css" path="${framework.src}/defaults.css"/>
	  	  	
	  	  	
	         	
	      </compc>
	
	</target>
	
	
	
	<target name="build_session_module">
	      <echo>Build Session Module</echo>
	       
		      <mxmlc 
		         file="${sessionmodule.src}/modules/${sessionmodule.name}.mxml"
		         output="${app.deploy}/modules/${sessionmodule.name}.swf"
		         debug="${debug}"
		         strict="true" 
		         optimize="true" 
		         load-externs="${framework.linkreport}" 
		      	 incremental="true"
		         warnings="true"
		         headless-server="true">
		         
		         <!-- define a source path (will include all files with .css, .as, .mxml extensions) -->
		         <source-path path-element="${sessionmodule.src}"/>
		         <!-- define a library path -->
		         <library-path dir="${framework.bin}" append="true">
		            <include name="${framework.swc}" />
		            <include name="${framework.assets.swc}" />
		         </library-path>
		      	
		        <library-path dir="${thirdparty.dir}" append="true">
		     	            <include name="${lib.swfaddress}" />
		     	            <include name="${lib.mate}" />
		     	            <include name="${lib.rmtp}" />
		     	            <include name="${lib.as3gettext}" />
		     	</library-path>
		     	         
		      </mxmlc>
		   </target>

	<target name="build_tutorat_module">
	      <echo>Build Tutorat Module</echo>
	       
		      <mxmlc 
		         file="${tutoratmodule.src}/modules/${tutoratmodule.name}.mxml"
		         output="${app.deploy}/modules/${tutoratmodule.name}.swf"
		         debug="${debug}"
		         strict="true" 
		         optimize="true" 
		      	incremental="true"
		        load-externs="${framework.linkreport}" 
		         warnings="true"
		         headless-server="true">
		         
		         <!-- define a source path (will include all files with .css, .as, .mxml extensions) -->
		         <source-path path-element="${tutoratmodule.src}"/>
		      	
		         <!-- define a library path -->
		         <library-path dir="${framework.bin}" append="true">
		            <include name="${framework.swc}" />
		            <include name="${framework.assets.swc}" />
		         </library-path>

		        <library-path dir="${thirdparty.dir}" append="true">
		     	            <include name="${lib.swfaddress}" />
		     	            <include name="${lib.mate}" />
		     	            <include name="${lib.rmtp}" />
		     	            <include name="${lib.as3gettext}" />
		     	         </library-path>
		     	         

		      </mxmlc>
		   </target>
	
	<target name="build_home_module">
	      <echo>Build Home Module</echo>
	       
		      <mxmlc 
		         file="${homemodule.src}/modules/${homemodule.name}.mxml"
		         output="${app.deploy}/modules/${homemodule.name}.swf"
		         debug="${debug}"
		         strict="true" 
		      	incremental="true"
		        load-externs="${framework.linkreport}" 
		         optimize="true" 
		         warnings="true"
		         headless-server="true">
		         
		         <!-- define a source path (will include all files with .css, .as, .mxml extensions) -->
		         <source-path path-element="${homemodule.src}"/>
		         <!-- define a library path -->
		         <library-path dir="${framework.bin}" append="true">
		            <include name="${framework.swc}" />
		            <include name="${framework.assets.swc}" />
		         </library-path>
		      	
		        <library-path dir="${thirdparty.dir}" append="true">
		     	            <include name="${lib.swfaddress}" />
		     	            <include name="${lib.mate}" />
		     	            <include name="${lib.rmtp}" />
		     	            <include name="${lib.as3gettext}" />
		     	         </library-path>
		     	         
		      	 
		      </mxmlc>
		   </target>
	
	<target name="build_retrospection_module">
	      <echo>Build Retrospection Module</echo>
	       
		      <mxmlc 
		         file="${retrospectionmodule.src}/modules/${retrospectionmodule.name}.mxml"
		         output="${app.deploy}/modules/${retrospectionmodule.name}.swf"
		         debug="${debug}"
		         strict="true" 
		        load-externs="${framework.linkreport}" 
		      	incremental="true"
		         optimize="true" 
		         warnings="true"
		         headless-server="true">
		         
		         <!-- define a source path (will include all files with .css, .as, .mxml extensions) -->
		         <source-path path-element="${retrospectionmodule.src}"/>
		         <!-- define a library path -->
		         <library-path dir="${framework.bin}" append="true">
		            <include name="${framework.swc}" />
		            <include name="${framework.assets.swc}" />
		         </library-path>
		      	
		        <library-path dir="${thirdparty.dir}" append="true">
		     	            <include name="${lib.swfaddress}" />
		     	            <include name="${lib.mate}" />
		     	            <include name="${lib.rmtp}" />
		     	            <include name="${lib.as3gettext}" />
		     	         </library-path>
		     	         
		      
		      </mxmlc>
		   </target>
	
	<target name="build_user_module">
	      <echo>Build User Module</echo>
	       
		      <mxmlc 
		         file="${usermodule.src}/modules/${usermodule.name}.mxml"
		         output="${app.deploy}/modules/${usermodule.name}.swf"
		         debug="${debug}"
		         strict="true" 
		         optimize="true" 
		      	incremental="true"
		         warnings="true"
		        load-externs="${framework.linkreport}" 
		         headless-server="true">
		         
		         <!-- define a source path (will include all files with .css, .as, .mxml extensions) -->
		         <source-path path-element="${usermodule.src}"/>
		         <!-- define a library path -->
		      	
		      	<library-path dir="${framework.bin}" append="true">
		      			            <include name="${framework.swc}" />
		            <include name="${framework.assets.swc}" />
		      			         </library-path>
		      	
		        <library-path dir="${thirdparty.dir}" append="true">
		     	            <include name="${lib.swfaddress}" />
		     	            <include name="${lib.mate}" />
		     	            <include name="${lib.rmtp}" />
		     	            <include name="${lib.as3gettext}" />
		     	</library-path>
		     	         
		     	
		      </mxmlc>
		   </target>

   <target name="build_all">
      <antcall target="build_framework_libs" />
      <antcall target="build_application" />
      <antcall target="build_user_module" />
      <antcall target="build_home_module" />
      <antcall target="build_session_module" />
      <antcall target="build_retrospection_module" />
      <antcall target="build_tutorat_module" />
   </target>
</project>