<?xml version="1.0"?>
<mate:LocalEventMap 
	xmlns:fx="http://ns.adobe.com/mxml/2009"
	xmlns:s="library://ns.adobe.com/flex/spark"
	xmlns:mx="library://ns.adobe.com/flex/halo"
	xmlns:mate="http://mate.asfusion.com/"
	xmlns:rtmp="com.flashdevs.mateExt.rtmpService.mate.*">
	<fx:Script><![CDATA[
		import business.SessionManager;
		
		import com.asfusion.mate.utils.debug.Debugger;
		import com.flashdevs.mateExt.rtmpService.RtmpService;
		import com.ithaca.visu.events.InitMapEvent;
		import com.ithaca.visu.events.SessionEvent;
		import com.ithaca.visu.model.Model;
		
		import com.ithaca.visu.view.session.SessionManagement;
		import mx.events.FlexEvent;
		
	]]></fx:Script>	
	<fx:Declarations>
		<mate:Debugger level="{Debugger.ALL}"/>
		
		<mate:EventHandlers type="{FlexEvent.PREINITIALIZE}" debug="true">
			<mate:ObjectBuilder generator="{SessionManager}" constructorArguments="{scope.dispatcher}"/>
				<rtmp:RtmpServiceInvoker service="{RtmpService}" cache="global">
					<mate:Request action="sessionInfo.getListSessionsAndPlans" />				
					<rtmp:resultHandlers>
						<mate:MethodInvoker generator="{SessionManager}"
											method="setSessionAndPlan" 
											arguments="{[currentEvent.data]}" />
					</rtmp:resultHandlers>
					
					<rtmp:faultHandlers>
						<mate:MethodInvoker generator="{SessionManager}" 
											method="onError" 
											arguments="{[currentEvent]}"/>
					</rtmp:faultHandlers>
				</rtmp:RtmpServiceInvoker>
		</mate:EventHandlers>
		
		<mate:EventHandlers type="{FlexEvent.CREATION_COMPLETE}" debug="true">
			<mate:MethodInvoker generator="{SessionManager}" method="notifyOutSession" />
		</mate:EventHandlers>
		
		<mate:EventHandlers type="{SessionEvent.OUT_SESSION}" debug="true">
			<rtmp:RtmpServiceInvoker service="{RtmpService}" cache="global">
				<mate:Request action="checkOutSession" arguments="{[event.userId]}"/>              
			</rtmp:RtmpServiceInvoker>
		</mate:EventHandlers>
		

		
		<mate:Injectors target="{SessionManager}">
			<mate:PropertyInjector targetKey="model" source="{Model.getInstance()}" />
		</mate:Injectors>
		
		<mate:Injectors target="{SessionManagement}" >
			<mate:PropertyInjector source="{SessionManager}"
								   sourceKey="sessions"
								   targetKey="sessions"
								   />
		</mate:Injectors>
	</fx:Declarations>
</mate:LocalEventMap>